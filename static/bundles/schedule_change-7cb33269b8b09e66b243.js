(()=>{"use strict";var e,t={"./assets/js/schedule_change.js":(e,t,s)=>{var r=s("./node_modules/vue/dist/vue.common.prod.js"),a=s.n(r),n=s("./node_modules/vuex/dist/vuex.esm.js"),o=s("./node_modules/axios/index.js"),i=s.n(o),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.loaded?e._e():s("div",{staticClass:"loading"}),e._v(" "),e.fullscreen?e._e():s("app-menu",{attrs:{"menu-info":e.menu}}),e._v(" "),e.loaded?s("b-container",{attrs:{fluid:e.fullscreen}},[s("b-row",[s("h2",[e._v("Changement d'horaire")])]),e._v(" "),e.fullscreen?e._e():s("b-row",[s("b-col",{attrs:{cols:"12",lg:"3"}},[s("b-form-group",[s("div",[e.$store.state.canAdd?s("b-btn",{staticClass:"w-100",attrs:{variant:"outline-success"},on:{click:function(t){return e.openModal("add-schedule-modal")}}},[s("icon",{attrs:{name:"plus",scale:"1",color:"green"}}),e._v("\n                            Ajouter un changement\n                        ")],1):e._e(),e._v(" "),s("b-btn",{staticClass:"w-100 mt-1",attrs:{variant:"secondary"},on:{click:function(t){return e.openModal("export-schedule-modal")}}},[s("icon",{attrs:{name:"file",scale:"1"}}),e._v("\n                            Sommaire\n                        ")],1)],1)])],1),e._v(" "),s("b-col",[s("filters",{ref:"filters",attrs:{app:"schedule_change",model:"schedule_change","show-search":e.showFilters},on:{update:e.applyFilter,toggleSearch:function(t){e.showFilters=!e.showFilters}}})],1)],1),e._v(" "),e.fullscreen?e._e():s("b-pagination",{staticClass:"mt-1",attrs:{"total-rows":e.entriesCount,"per-page":30},on:{change:e.changePage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}),e._v(" "),e._l(e.entriesGrouped,(function(t,r){return s("div",{key:r},[s("hr"),s("h5",{staticClass:"day"},[e._v("\n                "+e._s(e.calendar(t.day))+"\n            ")]),e._v(" "),s("b-card",{staticClass:"d-none d-md-block d-lg-block d-xl-block",attrs:{"no-body":""}},[e.fullscreen?s("table",{attrs:{width:"100%"}},[s("tr",[s("td",{attrs:{width:"20%"}},[s("strong",[e._v("Changement")])]),e._v(" "),s("td",{attrs:{width:"20%"}},[s("strong",[e._v("Classes")])]),e._v(" "),s("td",[s("strong",[e._v("Absent(s)/indisponible(s)")])]),e._v(" "),s("td")])]):s("b-row",{staticClass:"text-center"},[s("b-col",{attrs:{cols:e.fullscreen?3:2}},[s("strong",[e._v("Changement")])]),e._v(" "),s("b-col",{attrs:{cols:e.fullscreen?2:1}},[s("strong",[e._v("Classes")])]),e._v(" "),s("b-col",{attrs:{cols:e.fullscreen?"":3}},[s("strong",[e._v("Absent(s)/indisponible(s)")])])],1)],1),e._v(" "),e._l(t.sameDayEntries,(function(t,r){return s("div",{key:r},[s("hr",{staticClass:"smallhr"}),s("strong",[e._v(e._s(e.time(t)))]),e._v(" "),s("hr",{staticClass:"smallhr"}),e._v(" "),e.$store.state.ready?s("b-overlay",{attrs:{rounded:"sm"}},e._l(t.sameHourEntries,(function(t){return s("schedule-change-entry",{key:t.id,attrs:{"row-data":t,fullscreen:e.fullscreen},on:{delete:function(s){return e.askDelete(t)},edit:function(s){return e.editEntry(t,!1)},copy:function(s){return e.editEntry(t,!0)},showInfo:function(s){return e.showInfo(t)}}})})),1):e._e()],1)}))],2)}))],2):e._e(),e._v(" "),s("b-modal",{ref:"deleteModal",attrs:{"cancel-title":"Annuler","hide-header":"",centered:"","no-close-on-backdrop":!0,"no-close-on-esc":!0},on:{ok:e.deleteEntry,cancel:function(t){e.currentEntry=null}}},[e._v("\n        Êtes-vous sûr de vouloir supprimer ce changement ?\n    ")]),e._v(" "),s("add-schedule-modal",{ref:"addScheduleModal",attrs:{entry:e.currentEntry},on:{update:e.loadEntries,reset:function(t){e.currentEntry=null}}}),e._v(" "),s("export-schedule-modal",{ref:"exportScheduleModal"})],1)};l._withStripped=!0;var c=s("./node_modules/bootstrap-vue/esm/index.js"),u=(s("./node_modules/bootstrap-vue/dist/bootstrap-vue.css"),s("./node_modules/moment/moment.js")),d=s.n(u),h=s("./assets/common/filters.vue"),m=s("./assets/common/menu.vue"),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{appear:"",name:"fade"}},[s("b-card",{class:e.setCardClass(),attrs:{"no-body":""}},[e.fullscreen?s("table",{attrs:{width:"100%"}},[s("tr",[s("td",{attrs:{width:"20%"}},[e.rowData.category?s("icon",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"align-text-bottom",attrs:{name:e.icon,title:e.category}}):e._e(),e._v(" "),s("em",[e._v(e._s(e.formatChange(e.rowData.change)))])],1),e._v(" "),s("td",{attrs:{width:"20%"}},[e._v("\n                    "+e._s(e.rowData.classes)+"\n                ")]),e._v(" "),s("td",[e.rowData.teachers_substitute.length>0?s("s",[e._v(e._s(e.formatTeachers(e.rowData.teachers_replaced)))]):s("span",[e._v(e._s(e.formatTeachers(e.rowData.teachers_replaced)))]),e._v(" "),e.rowData.teachers_substitute.length>0?s("span",[s("icon",{attrs:{name:"arrow-right"}}),e._v("\n                        "+e._s(e.formatTeachers(e.rowData.teachers_substitute))+"\n                    ")],1):e._e()]),e._v(" "),s("td",{attrs:{align:"right"}},[e._v("\n                    "+e._s(e.rowData.place)+"\n                ")]),e._v(" "),e.hide_comment?e._e():s("td",{attrs:{align:"right"}},[e._v("\n                    "+e._s(e.rowData.comment)+"\n                ")])])]):s("b-row",{staticClass:"text-center"},[s("b-col",{staticClass:"current-data",attrs:{cols:e.fullscreen?3:2}},[e.rowData.category?s("icon",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"align-text-bottom",attrs:{name:e.icon,title:e.category}}):e._e(),e._v(" "),s("em",[e._v(e._s(e.formatChange(e.rowData.change)))])],1),e._v(" "),s("b-col",{staticClass:"current-data",attrs:{cols:e.fullscreen?2:1}},[e._v("\n                "+e._s(e.rowData.classes)+"\n            ")]),e._v(" "),s("b-col",{staticClass:"current-data",attrs:{cols:e.fullscreen?"":3}},[e.rowData.teachers_substitute.length>0?s("s",[e._v(e._s(e.formatTeachers(e.rowData.teachers_replaced)))]):s("span",[e._v(e._s(e.formatTeachers(e.rowData.teachers_replaced)))]),e._v(" "),e.rowData.teachers_substitute.length>0?s("span",[s("icon",{attrs:{name:"arrow-right"}}),e._v("\n                    "+e._s(e.formatTeachers(e.rowData.teachers_substitute))+"\n                ")],1):e._e()]),e._v(" "),e.rowData.place.length>0?s("b-col",{staticClass:"current-data",attrs:{cols:"2"}},[e._v("\n                "+e._s(e.rowData.place)+"\n            ")]):e._e(),e._v(" "),e.hide_comment?e._e():s("b-col",{staticClass:"current-data"},[e._v("\n                "+e._s(e.rowData.comment)+"\n            ")]),e._v(" "),e.$store.state.canAdd?s("b-col",{attrs:{cols:"1"}},[s("a",{staticClass:"card-link",attrs:{href:"#"},on:{click:e.editEntry}},[s("icon",{attrs:{name:"edit",scale:"1",color:"green"}})],1),e._v(" "),s("a",{attrs:{href:"#"},on:{click:e.copyEntry}},[s("icon",{attrs:{name:"copy",scale:"1",color:"blue"}})],1),e._v(" "),s("a",{attrs:{href:"#"},on:{click:e.deleteEntry}},[s("icon",{attrs:{name:"remove",scale:"1",color:"red"}})],1)]):e._e()],1)],1)],1)};p._withStripped=!0,d().locale("fr");const f={props:{rowData:{type:Object,default:function(){}},deleting:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1}},computed:{icon:function(){var e=this;return this.rowData.category?this.$store.state.changeCategory.filter((function(t){return t.id===e.rowData.category}))[0].icon:""},category:function(){var e=this;return this.rowData.category?this.$store.state.changeCategory.filter((function(t){return t.id===e.rowData.category}))[0].category:""},hide_comment:function(){return void 0!==this.$store.state.filters.find((function(e){return"activate_show_for_students"==e.filterType}))}},methods:{formatTeachers:function(e){return e.map((function(e){return e.display})).join(", ")},formatChange:function(e){for(var t=0;t<this.$store.state.changeType.length;t++)if(this.$store.state.changeType[t].id==e)return this.$store.state.changeType[t].name;return""},setCardClass:function(){var e="";return this.rowData.category&&(e+="category-"+this.rowData.category),"px-3 current-card "+e},deleteEntry:function(){this.$emit("delete")},editEntry:function(){this.$emit("edit")},copyEntry:function(){this.$emit("copy")}}};var _=s("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),g=s.n(_),v=s("./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/schedule_change/scheduleChangeEntry.vue?vue&type=style&index=0&lang=css&");g()(v.Z,{insert:"head",singleton:!1}),v.Z.locals;var b=s("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),y=(0,b.Z)(f,p,[],!1,null,null,null);y.options.__file="assets/schedule_change/scheduleChangeEntry.vue";const w=y.exports;var x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-modal",{ref:"addModal",attrs:{size:"lg",title:"Ajouter un changement","cancel-title":"Annuler","ok-disabled":!e.form.change||e.submitting||!e.$store.state.canAdd},on:{ok:e.submitForm,hidden:e.resetData}},[s("b-form",[s("b-form-row",[s("b-form-group",{attrs:{label:"Type de changement"}},[s("b-form-select",{attrs:{options:e.$store.state.changeType,"value-field":"id","text-field":"name"},model:{value:e.form.change,callback:function(t){e.$set(e.form,"change",t)},expression:"form.change"}})],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{attrs:{label:"Catégorie"}},[s("b-form-select",{attrs:{options:e.categoryOptions,"value-field":"id","text-field":"category"},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},[s("template",{slot:"first"},[s("option",{domProps:{value:null}})])],2)],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{attrs:{id:"date-start-input-group",label:"Date",state:e.inputStates.date_change}},[s("b-form-input",{attrs:{type:"date"},model:{value:e.form.date_change,callback:function(t){e.$set(e.form,"date_change",t)},expression:"form.date_change"}}),e._v(" "),s("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("date_change")))])],1)],1),e._v(" "),s("b-form-row",[s("b-form-group",{attrs:{id:"time-start-input-group",label:"Heure début",state:e.inputStates.time_start}},[s("b-form-input",{attrs:{type:"time"},model:{value:e.form.time_start,callback:function(t){e.$set(e.form,"time_start",t)},expression:"form.time_start"}}),e._v(" "),s("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("time_start")))])],1),e._v(" "),s("b-form-group",{attrs:{id:"time-end-input-group",label:"Heure fin",state:e.inputStates.time_end}},[s("b-form-input",{attrs:{type:"time"},model:{value:e.form.time_end,callback:function(t){e.$set(e.form,"time_end",t)},expression:"form.time_end"}}),e._v(" "),s("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("time_end")))])],1)],1),e._v(" "),s("b-form-group",{attrs:{label:"Classe(s) et/ou année(s) concernée(s)"}},[s("multiselect",{attrs:{"internal-search":!1,options:e.classesOptions,multiple:!0,loading:e.classesLoading,placeholder:"Chercher une classe ou une année…","select-label":"Appuyer sur entrée pour sélectionner ou cliquer dessus","selected-label":"Sélectionné","deselect-label":"Cliquer dessus pour enlever"},on:{"search-change":e.getStudentsClassesYears},model:{value:e.form.classes,callback:function(t){e.$set(e.form,"classes",t)},expression:"form.classes"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Aucune classe trouvée.")]),e._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"})])],1),e._v(" "),s("b-form-group",{attrs:{label:"Prof/Educ(s) absent(s) et/ou indisponible(s)"}},[s("multiselect",{attrs:{"internal-search":!1,options:e.teachersReplacedOptions,multiple:!0,placeholder:"Ajouter un ou des prof/educ…",loading:e.teachersReplacedLoading,"select-label":"Appuyer sur entrée pour sélectionner ou cliquer dessus","selected-label":"Sélectionné","deselect-label":"Cliquer dessus pour enlever",label:"display","track-by":"matricule"},on:{"search-change":e.getTeachersReplaced},model:{value:e.form.teachers_replaced,callback:function(t){e.$set(e.form,"teachers_replaced",t)},expression:"form.teachers_replaced"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Aucun professeur trouvé.")]),e._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"})])],1),e._v(" "),e.isReplacement?s("b-form-group",{attrs:{label:"Prof/Educ(s) remplacant(s)"}},[s("multiselect",{attrs:{"internal-search":!1,options:e.teachersSubstituteOptions,multiple:!0,placeholder:"Ajouter un ou des professeurs…",loading:e.teachersReplacedLoading,"select-label":"Appuyer sur entrée pour sélectionner ou cliquer dessus","selected-label":"Sélectionné","deselect-label":"Cliquer dessus pour enlever",label:"display","track-by":"matricule"},on:{"search-change":e.getTeachersSubstitute},model:{value:e.form.teachers_substitute,callback:function(t){e.$set(e.form,"teachers_substitute",t)},expression:"form.teachers_substitute"}},[s("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Aucun professeur trouvé.")]),e._v(" "),s("span",{attrs:{slot:"noOptions"},slot:"noOptions"})])],1):e._e(),e._v(" "),s("b-form-group",{attrs:{label:"Local/Lieu de subtitution"}},[s("multiselect",{attrs:{"tag-placeholder":"Ajouter le local/lieu",placeholder:"Ajouter local/lieu",taggable:!0,options:e.placesOptions,"select-label":"Appuyer sur entrée pour sélectionner ou cliquer dessus","selected-label":"Sélectionné","deselect-label":"Cliquer dessus pour enlever"},on:{tag:e.addPlaces},model:{value:e.form.place,callback:function(t){e.$set(e.form,"place",t)},expression:"form.place"}},[s("span",{attrs:{slot:"noOptions"},slot:"noOptions"})])],1),e._v(" "),s("b-form-group",{attrs:{label:"Commentaire"}},[s("b-form-textarea",{attrs:{rows:2,placeholder:"Un commentaire sur le changement"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1),e._v(" "),s("b-form-group",[s("b-form-checkbox",{model:{value:e.form.send_email_general,callback:function(t){e.$set(e.form,"send_email_general",t)},expression:"form.send_email_general"}},[e._v("\n                Notifier le changement par courriel\n            ")])],1),e._v(" "),s("b-form-group",[e.form.teachers_substitute.length>0?s("b-form-checkbox",{model:{value:e.form.send_email_substitute,callback:function(t){e.$set(e.form,"send_email_substitute",t)},expression:"form.send_email_substitute"}},[e._v("\n                Notifier le remplaçant par courriel\n            ")]):e._e()],1),e._v(" "),s("b-form-group",[s("b-form-checkbox",{model:{value:e.form.hide_for_students,callback:function(t){e.$set(e.form,"hide_for_students",t)},expression:"form.hide_for_students"}},[e._v("\n                Cacher aux étudiants\n            ")])],1)],1),e._v(" "),s("template",{slot:"modal-ok"},[e.submitting?s("icon",{staticClass:"align-baseline",attrs:{name:"spinner",scale:"1",spin:""}}):e._e(),e._v("\n        Soumettre\n    ")],1)],2)};x._withStripped=!0;var C=s("./node_modules/vue-multiselect/dist/vue-multiselect.min.js"),k=s.n(C);s("./node_modules/vue-multiselect/dist/vue-multiselect.min.css"),d().locale("fr");const T={props:{entry:{type:Object,default:function(){return null}}},data:function(){return{searchId:-1,form:{change:null,category:null,date_change:"",time_start:null,time_end:null,classes:[],teachers_replaced:[],teachers_replaced_id:[],teachers_substitute:[],teachers_substitute_id:[],place:"",comment:"",send_email_general:!1,send_email_substitute:!1,hide_for_students:!1},classesOptions:[],classesLoading:!1,categoryOptions:[],teachersReplacedOptions:[],teachersReplacedLoading:!1,teachersSubstituteOptions:[],teachersSubstituteLoading:!1,placesOptions:[],submitting:!1,errors:{},inputStates:{date_change:null,time_start:null,time_end:null}}},watch:{entry:function(e){e?(Object.assign(this.form,e),this.form.time_start&&(this.form.time_start=this.form.time_start.slice(0,5)),this.form.time_end&&(this.form.time_end=this.form.time_end.slice(0,5)),this.form.classes=this.initArray(this.form.classes),this.form.teachers_replaced_id=this.form.teachers_replaced,this.form.teachers_substitute_id=this.form.teachers_substitute):this.resetData()},errors:function(e){var t=Object.keys(this.inputStates);for(var s in t)t[s]in e?this.inputStates[t[s]]=0==e[t[s]].length:this.inputStates[t[s]]=null}},computed:{isReplacement:function(){for(var e in this.$store.state.changeType)if("Remplacement"==this.$store.state.changeType[e].name&&this.$store.state.changeType[e].id==this.form.change)return!0;return!1}},methods:{addPlaces:function(e){this.placesOptions.push(e),this.form.place=e},initArray:function(e){return e.length>0?e.split(", "):[]},resetData:function(){var e=this.placesOptions;Object.assign(this.$data,this.$options.data.call(this)),this.placesOptions=e,this.categoryOptions=this.$store.state.changeCategory,this.$emit("reset")},show:function(){this.categoryOptions=this.$store.state.changeCategory,this.$refs.addModal.show()},hide:function(){this.$refs.addModal.hide()},errorMsg:function(e){return e in this.errors?this.errors[e][0]:""},getPlaces:function(){var e=this;i().get("/schedule_change/api/schedule_change_place/",{xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"}).then((function(t){e.placesOptions=t.data.results.map((function(e){return e.name}))}))},getStudentsClassesYears:function(e){var t=this;this.classesLoading=!0;var s=this;this.searchId+=1;var r=this.searchId,a={query:e,teachings:this.$store.state.settings.teachings,check_access:!1,years:!0};i().post("/annuaire/api/classes/",a,{xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"}).then((function(e){if(t.searchId===r){var s=e.data.map((function(e){return e.display}));t.classesLoading=!1,t.classesOptions=s}})).catch((function(e){alert(e),s.classesLoading=!1}))},getTeachersReplaced:function(e){this.getTeachers(e,"replaced")},getTeachersSubstitute:function(e){this.getTeachers(e,"substitute")},getTeachers:function(e,t){var s=this;"replaced"==t?this.teachersReplacedLoading=!0:this.teachersSubstituteLoading=!0;var r=this;this.searchId+=1;var a=this.searchId,n={query:e,teachings:this.$store.state.settings.teachings,people:"responsible",check_access:!1,active:!1};i().post("/annuaire/api/people/",n,{xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"}).then((function(e){if(s.searchId===a){var r=e.data;"replaced"==t?(s.teachersReplacedLoading=!1,s.teachersReplacedOptions=r):(s.teachersSubstituteLoading=!1,s.teachersSubstituteOptions=r)}})).catch((function(e){alert(e),"replaced"==t?r.teachersReplacedLoading=!1:r.teachersSubstituteLoading=!1}))},submitForm:function(e){var t=this;e.preventDefault(),this.submitting=!0;var s=this,r=Object.assign({},this.form);r.teachers_replaced_id=r.teachers_replaced.map((function(e){return e.matricule})),r.teachers_substitute_id=r.teachers_substitute.map((function(e){return e.matricule})),""==r.time_start&&(r.time_start=null),""==r.time_end&&(r.time_end=null),null==r.place&&(r.place="");var a={xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"},n="/schedule_change/api/schedule_change/",o=this.entry&&this.entry.id;o&&(n+=this.form.id+"/"),(o?i().put(n,r,a):i().post(n,r,a)).then((function(){t.hide(),t.errors={},t.$emit("update"),t.submitting=!1})).catch((function(e){s.submitting=!1,s.errors=e.response.data}))}},components:{Multiselect:k()},mounted:function(){this.getPlaces()}};var j=(0,b.Z)(T,x,[],!1,null,null,null);j.options.__file="assets/schedule_change/addScheduleModal.vue";const $=j.exports;var S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-modal",{ref:"exportModal",attrs:{size:"lg",title:"Exporter un récapitulatif","cancel-title":"Annuler","ok-disabled":!e.export_to||!e.export_from||e.processing},on:{ok:e.submitExport,hidden:e.resetModal}},[s("b-row",{staticClass:"mt-2"},[s("b-col",[s("b-form-row",[s("b-form-group",{attrs:{label:"À partir du"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.export_from,expression:"export_from"}],attrs:{type:"date",max:e.export_to},domProps:{value:e.export_from},on:{input:function(t){t.target.composing||(e.export_from=t.target.value)}}})])],1)],1),e._v(" "),s("b-col",[s("b-form-row",[s("b-form-group",{attrs:{label:"Jusqu'au"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.export_to,expression:"export_to"}],attrs:{type:"date",min:e.export_from},domProps:{value:e.export_to},on:{input:function(t){t.target.composing||(e.export_to=t.target.value)}}})])],1)],1)],1),e._v(" "),e.$store.state.canAdd?s("b-row",{staticClass:"ml-2"},[s("b-form-group",[s("b-checkbox",{model:{value:e.sendToTeachers,callback:function(t){e.sendToTeachers=t},expression:"sendToTeachers"}},[e._v("\n                Envoyer le récapitulatif aux enseignants concernés\n            ")])],1)],1):e._e(),e._v(" "),s("b-row",[s("b-col",[e.sendToTeachers?s("b-form-textarea",{attrs:{placeholder:"Message à inclure dans l'email",rows:"3","max-rows":"6",maxlength:"240"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}):e._e()],1)],1),e._v(" "),s("template",{slot:"modal-ok"},[e.processing?s("icon",{staticClass:"align-baseline",attrs:{name:"spinner",scale:"1",spin:""}}):e._e(),e._v("\n        "+e._s(e.buttonStr)+"\n    ")],1)],2)};S._withStripped=!0;const E={data:function(){return{export_to:null,export_from:null,buttonStr:"Créer le pdf",sendToTeachers:!1,message:"",ws:null,processing:!1}},watch:{sendToTeachers:function(e){this.buttonStr=e?"Créer le PDF et envoyer":"Créer le PDF"},export_from:function(e){e&&!this.export_to&&(this.export_to=this.export_from)}},methods:{show:function(){this.$refs.exportModal.show()},submitExport:function(e){e.preventDefault();var t=this;this.buttonStr="Traitement en cours",this.processing=!0;var s="/schedule_change/api/summary_pdf/?page_size=500&date_change__gte="+this.export_from+"&date_change__lte="+this.export_to+"&send_to_teachers="+this.sendToTeachers+"&message="+encodeURIComponent(this.message);i().get(s,{xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"}).then((function(e){var s="http:"===window.location.protocol?"ws":"wss";t.ws=new WebSocket(s+"://"+window.location.host+"/ws/schedule_change/export_summary/"+JSON.parse(e.data)+"/"),t.ws.onmessage=function(e){window.open(JSON.parse(e.data).file_url,"_blank"),t.sendToTeachers=!1,t.buttonStr="Créer le PDF",t.processing=!1}}))},resetModal:function(){Object.assign(this.$data,this.$options.data.call(this))}}};var O=(0,b.Z)(E,S,[],!1,null,null,null);O.options.__file="assets/schedule_change/exportScheduleModal.vue";const D=O.exports;s("./node_modules/vue-awesome/icons/index.js");var F=s("./node_modules/vue-awesome/components/Icon.vue");d().locale("fr"),window.axios=i(),window.axios.defaults.baseURL=window.location.origin,a().component("icon",F.Z),a().use(c.ZPm);const P={data:function(){return{menu:{},loaded:!1,active:!0,currentPage:1,showFilters:!1,filter:"",ordering:"",currentEntry:null,entries:[],entriesGrouped:[],entriesCount:0,inputStates:{},fullscreen:!1}},methods:{calendar:function(e){return d()(e).calendar().split(" à")[0]},time:function(e){var t="";return e.time_start&&(t+=e.time_start.slice(0,5),e.time_end?t+=" à ":t="À partir de "+t),e.time_end&&(e.time_start||(t+="Jusqu'à "),t+=e.time_end.slice(0,5)),""===t&&(t="Toute la journée"),t},changePage:function(e){this.currentPage=e,this.loadEntries()},openModal:function(e){"add-schedule-modal"===e&&this.$refs.addScheduleModal.show(),"export-schedule-modal"===e&&this.$refs.exportScheduleModal.show()},applyFilter:function(){this.filter="";var e=this.$store.state.filters;for(var t in e)if(e[t].filterType.startsWith("date")||e[t].filterType.startsWith("time")){var s=e[t].value.split("_");this.filter+="&"+e[t].filterType+"__gte="+s[0],this.filter+="&"+e[t].filterType+"__lte="+s[1]}else this.filter+="&"+e[t].filterType+"="+e[t].value;this.currentPage=1,this.loadEntries()},askDelete:function(e){this.currentEntry=e,this.$refs.deleteModal.show()},deleteEntry:function(){var e=this;i().delete("/schedule_change/api/schedule_change/"+this.currentEntry.id,{xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"}).then((function(){e.loadEntries()})),this.currentEntry=null},editEntry:function(e,t){t?(this.currentEntry=Object.assign({},e),delete this.currentEntry.id):this.currentEntry=e,this.openModal("add-schedule-modal")},loadEntries:function(){var e=this;i().get("/schedule_change/api/schedule_change/?page_size=30&page="+this.currentPage+this.filter+this.ordering).then((function(t){if(e.entries=t.data.results,e.entriesCount=t.data.count,0==e.entriesCount)return e.entriesGrouped=[],void(e.loaded=!0);if(e.entriesGrouped=[{sameDayEntries:[{sameHourEntries:[e.entries[0]],time_start:e.entries[0].time_start,time_end:e.entries[0].time_end}],day:e.entries[0].date_change}],1!=e.entriesCount){for(var s=1;s<e.entries.length;s++)if(e.entriesGrouped[e.entriesGrouped.length-1].day==e.entries[s].date_change){var r=e.entriesGrouped[e.entriesGrouped.length-1],a=r.sameDayEntries.length;r.sameDayEntries[a-1].time_start==e.entries[s].time_start&&r.sameDayEntries[a-1].time_end==e.entries[s].time_end?r.sameDayEntries[a-1].sameHourEntries.push(e.entries[s]):r.sameDayEntries.push({sameHourEntries:[e.entries[s]],time_start:e.entries[s].time_start,time_end:e.entries[s].time_end})}else e.entriesGrouped.push({sameDayEntries:[{sameHourEntries:[e.entries[s]],time_start:e.entries[s].time_start,time_end:e.entries[s].time_end}],day:e.entries[s].date_change});e.loaded=!0}else e.loaded=!0}))},checkFullscreenMode:function(){window.location.href.includes("fullscreen")&&(this.fullscreen=!0,this.$store.commit("enableFullscreen"),window.location.href.includes("show_for_students")&&this.$store.commit("addFilter",{filterType:"activate_show_for_students",tag:"Activer",value:!0}))}},mounted:function(){this.checkFullscreenMode(),this.menu=menu,this.applyFilter()},components:{filters:h.Z,"app-menu":m.Z,"add-schedule-modal":$,"export-schedule-modal":D,"schedule-change-entry":w}};var A=s("./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/schedule_change/schedule_change.vue?vue&type=style&index=0&lang=css&");g()(A.Z,{insert:"head",singleton:!1}),A.Z.locals;var M=(0,b.Z)(P,l,[],!1,null,null,null);M.options.__file="assets/schedule_change/schedule_change.vue";const R=M.exports;a().use(n.ZP);var L={xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"},N=new n.ZP.Store({state:{settings,filters:[{filterType:"activate_ongoing",tag:"Activer",value:!0}],changeType:[],changeCategory:[],canAdd:can_add,ready:!1},actions:{getChangeType:function(e){i().get("/schedule_change/api/schedule_change_type/",L).then((function(t){e.commit("setChangeType",t.data.results)}))},getChangeCategory:function(e){i().get("/schedule_change/api/schedule_change_category/",L).then((function(t){e.commit("setChangeCategory",t.data.results)}))}},mutations:{enableFullscreen:function(e){e.canAdd=!1,this.commit("addFilter",{filterType:"activate_has_classe",tag:"Activer",value:!0})},setChangeType:function(e,t){e.changeType=t},setChangeCategory:function(e,t){e.changeCategory=t,e.ready=!0;var s=document.createElement("style");for(var r in t)s.innerHTML+=".category-"+t[r].id+" {background-color: #"+t[r].color+"60;} ";document.body.appendChild(s)},addFilter:function(e,t){"matricule_id"===t.filterType&&this.commit("removeFilter","name"),this.commit("removeFilter",t.filterType),e.filters.push(t)},removeFilter:function(e,t){for(var s in e.filters)if(e.filters[s].filterType===t){e.filters.splice(s,1);break}}}});new(a())({el:"#vue-app",store:N,template:"<schedule-change/>",components:{ScheduleChange:R},mounted:function(){this.$store.dispatch("getChangeType"),this.$store.dispatch("getChangeCategory")}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/schedule_change/scheduleChangeEntry.vue?vue&type=style&index=0&lang=css&":(e,t,s)=>{s.d(t,{Z:()=>n});var r=s("./node_modules/css-loader/dist/runtime/api.js"),a=s.n(r)()((function(e){return e[1]}));a.push([e.id,"\n.current-card {\n    margin-top: .3rem;\n}\n.current-data {\n    margin-left: .2rem;\n    background-color: rgba(104, 104, 104, 0.1);\n}\n.fade-enter-active {\n  transition: opacity .5s\n}\n.fade-enter, .fade-leave-to .fade-leave-active {\n  opacity: 0\n}\n",""]);const n=a},"./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/schedule_change/schedule_change.vue?vue&type=style&index=0&lang=css&":(e,t,s)=>{s.d(t,{Z:()=>u});var r=s("./node_modules/css-loader/dist/runtime/api.js"),a=s.n(r),n=s("./node_modules/css-loader/dist/runtime/getUrl.js"),o=s.n(n),i=s("./static/img/spin.svg"),l=a()((function(e){return e[1]})),c=o()(i.Z);l.push([e.id,'\n.loading {\n    content: " ";\n    display: block;\n    position: absolute;\n    width: 80px;\n    height: 80px;\n    background-image: url('+c+");\n    background-size: cover;\n    left: 50%;\n    top: 50%;\n}\n.day {\n    text-align: center;\n}\n.smallhr {\n    margin-top: 0.2rem;\n    margin-bottom: 0.2rem;\n}\n",""]);const u=l}},s={};function r(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}r.m=t,e=[],r.O=(t,s,a,n)=>{if(!s){var o=1/0;for(c=0;c<e.length;c++){for(var[s,a,n]=e[c],i=!0,l=0;l<s.length;l++)(!1&n||o>=n)&&Object.keys(r.O).every((e=>r.O[e](s[l])))?s.splice(l--,1):(i=!1,n<o&&(o=n));i&&(e.splice(c--,1),t=a())}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,a,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.j=822,(()=>{var e={822:0};r.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,i,l]=s,c=0;for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(l)var u=l(r);for(t&&t(s);c<o.length;c++)n=o[c],r.o(e,n)&&e[n]&&e[n][0](),e[o[c]]=0;return r.O(u)},s=self.webpackChunkhappyschool=self.webpackChunkhappyschool||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=r.O(void 0,[351],(()=>r("./assets/js/schedule_change.js")));a=r.O(a)})();