(()=>{"use strict";var e,t={"./assets/js/dossier_eleve.js":(e,t,n)=>{var s=n("./node_modules/vue/dist/vue.common.prod.js"),i=n.n(s),a=n("./node_modules/vuex/dist/vuex.esm.js"),o=n("./assets/common/filters.js");i().use(a.ZP);const r=new a.ZP.Store({state:{settings,filters:[{filterType:"scholar_year",tag:currentYear,value:currentYear}],canSetSanction,canAskSanction},mutations:{addFilter:o.KJ,removeFilter:o.ku}});var l=n("./node_modules/vue-router/dist/vue-router.esm.js"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.loaded?e._e():n("div",{staticClass:"loading"}),e._v(" "),e.loaded?n("b-container",[n("b-row",[n("h2",[e._v("Dossier des élèves")])]),e._v(" "),e.canAskSanction?n("b-row",{staticClass:"mb-2"},[n("b-nav",{attrs:{tabs:""}},[n("b-nav-item",{attrs:{active:"",href:"/dossier_eleve/"}},[e._v("\n                    Dossier des élèves\n                ")]),e._v(" "),n("b-nav-item",{attrs:{href:"/dossier_eleve/ask_sanctions"}},[n("span",{staticClass:"text-danger"},[e._v("Demandes de sanction")]),e._v(" "),e.$store.state.canSetSanction?n("span",[n("b-badge",[e._v(e._s(e.askSanctionsCount))]),e._v(" "),n("b-badge",{attrs:{variant:"warning"}},[e._v(e._s(e.askSanctionsNotDoneCount))])],1):e._e()])],1)],1):e._e(),e._v(" "),n("b-row",[n("b-col",{attrs:{cols:"12",lg:"3"}},[n("b-form-group",[n("div",[n("b-btn",{staticClass:"w-100",attrs:{variant:"primary",to:"/new/"}},[n("b-icon",{attrs:{icon:"plus"}}),e._v("\n                            Nouveau cas\n                        ")],1),e._v(" "),n("b-btn",{staticClass:"w-100 mt-1",attrs:{variant:"secondary"},on:{click:function(t){return e.openDynamicModal("export-modal")}}},[n("b-icon",{attrs:{icon:"file-earmark-text"}}),e._v("\n                            Export\n                        ")],1)],1)])],1),e._v(" "),n("b-col",[n("filters",{ref:"filters",attrs:{app:"dossier_eleve",model:"cas_eleve","show-search":e.showFilters},on:{update:e.applyFilter,toggleSearch:function(t){e.showFilters=!e.showFilters}}})],1)],1),e._v(" "),n("b-pagination",{staticClass:"mt-1",attrs:{"total-rows":e.entriesCount,"per-page":20},on:{change:e.changePage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}),e._v(" "),e._l(e.entries,(function(t){return n("cas-eleve-entry",{key:t.id,attrs:{"row-data":t},on:{delete:function(n){return e.askDelete(t)},filterStudent:function(t){return e.filterStudent(t)},showInfo:function(n){return e.showInfo(t)}}})})),e._v(" "),n("b-modal",{ref:"infoModal",attrs:{title:e.currentName,size:"lg",centered:"","ok-only":""},on:{hidden:function(t){e.currentEntry=null}}},[e.currentEntry?n("info",{attrs:{matricule:e.currentEntry.matricule_id,type:"student","no-news":""}}):e._e()],1),e._v(" "),n(e.currentModal,{ref:"dynamicModal",tag:"component",attrs:{entry:e.currentEntry,"entries-count":e.entriesCount},on:{update:e.loadEntries,reset:function(t){e.currentEntry=null}}}),e._v(" "),n("b-pagination",{staticClass:"mt-1",attrs:{"total-rows":e.entriesCount,"per-page":20},on:{change:e.changePage},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],2):e._e()],1)};c._withStripped=!0;var d=n("./node_modules/bootstrap-vue/esm/index.js"),u=n("./node_modules/bootstrap-vue/esm/icons/plugin.js"),m=(n("./node_modules/bootstrap-vue/dist/bootstrap-vue.css"),n("./node_modules/vue-awesome/icons/index.js"),n("./node_modules/vue-awesome/components/Icon.vue")),p=n("./node_modules/axios/index.js"),f=n.n(p),_=n("./assets/annuaire/info.vue"),v=n("./assets/common/filters.vue"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("transition",{attrs:{appear:"",name:"fade"}},[n("b-card",{class:"px-4 mt-2 current-card "+e.cardClass,attrs:{"no-body":""}},[n("b-row",{staticClass:"entry-title"},[n("b-col",[n("h5",[n("a",{staticClass:"clickable",on:{click:function(t){return e.$emit("showInfo")}}},[e._v(e._s(e.title))]),e._v(" "),n("b-btn",{attrs:{variant:"link",size:"sm"},on:{click:e.filterStudent}},[n("b-icon",{attrs:{icon:"funnel"}})],1)],1)]),e._v(" "),n("b-col",{attrs:{sm:"2"}},[n("div",{staticClass:"text-right"},[n("b-btn",{staticClass:"card-link",attrs:{variant:"light",size:"sm",to:"/edit/"+e.rowData.id+"/"}},[n("b-icon",{attrs:{icon:"pencil-square",variant:"success"}})],1),e._v(" "),n("b-btn",{staticClass:"card-link",attrs:{variant:"light",size:"sm"},on:{click:e.deleteEntry}},[n("b-icon",{attrs:{icon:"trash-fill",variant:"danger"}})],1)],1)])],1),e._v(" "),n("b-row",{staticClass:"entry-subtitle"},[n("em",[e._v(e._s(e.subtitle))]),e._v(" "),e.rowData.attachments.length>0?n("icon",{attrs:{name:"paperclip",color:"blue"}}):e._e()],1),e._v(" "),n("b-row",{staticClass:"text-center"},[n("b-col",{staticClass:"category",attrs:{md:"2"}},[e.isInfo?n("b-icon",{attrs:{icon:"info-circle-fill",variant:"primary"}}):n("b-icon",{attrs:{icon:"bell-fill",variant:"danger"}}),e._v("\n                    "+e._s(e.category)+"\n                ")],1),e._v(" "),n("b-col",{staticClass:"current-data mb-1 mr-1"},[n("span",{domProps:{innerHTML:e._s(e.comment)}}),e._v(" "),e.comment.length>150?n("b-btn",{staticClass:"move-up",attrs:{size:"sm",variant:"light"},on:{click:function(t){e.expand=!e.expand}}},[n("icon",{staticClass:"align-text-top",attrs:{color:"grey",scale:"1.1",name:e.expand?"angle-double-up":"angle-double-down"}})],1):e._e()],1)],1)],1)],1)],1)};h._withStripped=!0;var b=n("./node_modules/moment/moment.js"),g=n.n(b),y=n("./assets/common/utilities.js");g().locale("fr");const w={props:{rowData:{type:Object,default:function(){}}},data:function(){return{expand:!1}},computed:{new:function(){return g()(this.rowData.datetime_modified)>g()(dossierEleveLastAccess)},title:function(){return this.displayStudent(this.rowData.matricule)},subtitle:function(){var e="";return this.rowData.datetime_sanction&&(e+="Sanction : "+g()(this.rowData.datetime_sanction).format("DD/MM/YY")+". "),e+="Demandé par "+this.rowData.demandeur+" ("+g()(this.rowData.datetime_encodage).calendar()+")"},category:function(){return this.rowData.info?this.rowData.info.info:this.rowData.sanction_decision?this.rowData.sanction_decision.sanction_decision:""},cardClass:function(){var e=this.isInfo?"info":"sanction_decision",t=this.rowData.important?"important":"",n=this.new?"new":"";return"".concat(t," ").concat(e," ").concat(n)},isInfo:function(){return!!this.rowData.info},comment:function(){var e=this.rowData.explication_commentaire.replace(/(<([^>]+)>)/gi,"").length;if(this.expand||e<151)return this.rowData.explication_commentaire;var t=this.rowData.explication_commentaire.length-e,n=this.rowData.explication_commentaire.substring(0,150+t)+"…";return n.startsWith("<p>")&&(n+="</p>"),n}},methods:{deleteEntry:function(){this.$emit("delete")},filterStudent:function(){this.$emit("filterStudent",this.rowData.matricule_id)},displayStudent:y.v}};var x=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),k=n.n(x),O=n("./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/dossier_eleve/casEleveEntry.vue?vue&type=style&index=0&lang=css&");k()(O.Z,{insert:"head",singleton:!1}),O.Z.locals;var j=n("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),S=(0,j.Z)(w,h,[],!1,null,null,null);S.options.__file="assets/dossier_eleve/casEleveEntry.vue";const C=S.exports;var D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-modal",{ref:"exportModal",attrs:{size:"lg",title:"Exporter des données dans un fichier","ok-title":"Créer pdf","ok-only":!0,"ok-disabled":!e.isOk},on:{ok:e.getPdf,hidden:e.resetModal}},[n("b-tabs",{model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[n("b-tab",{attrs:{title:"Sommaire",active:""}},[n("b-row",[n("b-col",[n("b-form-group",{attrs:{label:"Nom, prénom ou classe","label-for":"input-name-classe"}},[n("multiselect",{attrs:{id:"input-name-classe","internal-search":!1,options:e.nameClasseOptions,loading:e.nameClasseLoading,placeholder:"Rechercher un étudiant ou une classe…","select-label":"","selected-label":"Sélectionné","deselect-label":"",label:"display","track-by":"id"},on:{"search-change":e.getNameClasseOptions},model:{value:e.nameClasse,callback:function(t){e.nameClasse=t},expression:"nameClasse"}},[n("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Aucune personne trouvée.")]),e._v(" "),n("span",{attrs:{slot:"noOptions"},slot:"noOptions"})])],1),e._v(" "),n("b-form-group",{attrs:{label:"Type de données"}},[n("b-form-checkbox",{model:{value:e.info,callback:function(t){e.info=t},expression:"info"}},[e._v("\n                                Informations\n                            ")]),e._v(" "),n("b-form-checkbox",{model:{value:e.sanction,callback:function(t){e.sanction=t},expression:"sanction"}},[e._v("\n                                Sanctions\n                            ")]),e._v(" "),n("b-form-checkbox",{model:{value:e.allYears,callback:function(t){e.allYears=t},expression:"allYears"}},[e._v("\n                                Toutes années scolaires confondues\n                            ")])],1)],1)],1)],1),e._v(" "),n("b-tab",{attrs:{title:"Filtre courant"}},[n("p",[e._v("\n                    Vous pouvez exporter l'affichage courant (toutes pages confondues).\n                ")]),e._v(" "),n("p",[e._v("\n                    Le nombre de cas filtré est de : "+e._s(e.entriesCount)+"\n                ")]),e._v(" "),n("b-alert",{attrs:{variant:"warning",show:e.entriesCount>100&&e.entriesCount<1e3}},[e._v("\n                    Le nombre de cas est relativement grand. La génération du pdf peut prendre un certain temps.\n                ")]),e._v(" "),n("b-alert",{attrs:{variant:"danger",show:e.entriesCount>=1e3}},[e._v("\n                    Le nombre de cas est très grand ! Êtes-vous sûr de vouloir exporter autant de cas ?\n                ")])],1)],1)],1)],1)};D._withStripped=!0;var $=n("./node_modules/vue-multiselect/dist/vue-multiselect.min.js"),F=n.n($);n("./node_modules/vue-multiselect/dist/vue-multiselect.min.css"),g().locale("fr");const M={props:{entriesCount:{type:Number,default:0}},data:function(){return{searchId:0,tabIndex:0,nameClasse:null,nameClasseOptions:[],nameClasseLoading:!1,info:!0,sanction:!0,allYears:!1}},computed:{isOk:function(){return 0==this.tabIndex?this.nameClasse:1==this.tabIndex}},methods:{show:function(){this.$refs.exportModal.show()},hide:function(){this.$refs.exportModal.hide()},resetModal:function(){this.nameClasse=null,this.info=!0,this.sanction=!0,this.allYears=!1},getNameClasseOptions:function(e){var t=this;this.searchId+=1;var n=this.searchId,s={query:e,teachings:this.$store.state.settings.teachings,people:"student",check_access:!0};f().post("/annuaire/api/people_or_classes/",s,{xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"}).then((function(s){if(t.searchId===n){var i=s.data.map((function(t){if(Number.isNaN(Number.parseInt(e[0]))){var n=" "+t.classe.year+t.classe.letter.toUpperCase();return{display:t.last_name+" "+t.first_name+n+" – "+t.teaching.display_name,id:t.matricule}}return t}));t.nameClasseOptions=i}}))},getPdf:function(e){if(e.preventDefault(),0==this.tabIndex){var t="/dossier_eleve/get_pdf/?page_size=500&";t+="letter"in this.nameClasse?"classe=":"matricule_id=",t+=this.nameClasse.id,t+=this.info?"":"&no_infos=true",t+=this.sanction?"":"&no_sanctions=true",t+=this.allYears?"":"&scholar_year="+currentYear,t+="&ordering=matricule__last_name",window.open(t)}else if(1==this.tabIndex){var n="/dossier_eleve/get_pdf_list/?page_size=2000".concat((0,o.Zj)(this.$store.state.filters));window.open(n)}}},mounted:function(){this.show()},components:{Multiselect:F()}};var E=(0,j.Z)(M,D,[],!1,null,null,null);E.options.__file="assets/dossier_eleve/exportModal.vue";const I=E.exports;i().use(d.XG7),i().use(u.X),i().component("icon",m.Z),window.axios=f(),window.axios.defaults.baseURL=window.location.origin;var P={xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"};const A={data:function(){return{menuInfo:{},entriesCount:0,currentPage:1,entries:[],currentEntry:null,currentModal:null,filter:"",ordering:"&ordering=",showFilters:!1,loaded:!1,askSanctionsCount:0,askSanctionsNotDoneCount:0}},computed:{currentName:function(){return this.currentEntry?this.currentEntry.matricule.display:""},canAskSanction:function(){var e=this.$store.state.settings.enable_submit_sanctions,t=this.$store.state.canAskSanction;return e&&t}},methods:{changePage:function(e){this.currentPage=e,this.loadEntries(),scroll(0,0)},openDynamicModal:function(e){this.currentModal=e,"dynamicModal"in this.$refs&&this.$refs.dynamicModal.show()},showInfo:function(e){this.currentEntry=e,this.$refs.infoModal.show()},filterStudent:function(e){this.showFilters=!0,this.$store.commit("addFilter",{filterType:"matricule_id",tag:e,value:e}),this.applyFilter()},applyFilter:function(){this.filter=(0,o.Zj)(this.$store.state.filters),this.currentPage=1,this.loadEntries()},askDelete:function(e){var t=this;this.$bvModal.msgBoxConfirm("Êtes-vous sûr de vouloir supprimer l'entrée ?",{centered:!0,buttonSize:"sm",okVariant:"danger",okTitle:"Oui",cancelTitle:"Annuler"}).then((function(n){n&&f().delete("/dossier_eleve/api/cas_eleve/".concat(e.id,"/"),P).then((function(){t.loadEntries()}))}))},deleteEntry:function(){this.currentEntry=null},loadEntries:function(){var e=this;f().get("/dossier_eleve/api/cas_eleve/?page="+this.currentPage+this.filter+this.ordering).then((function(t){e.entriesCount=t.data.count,e.entries=t.data.results,e.loaded=!0}))},checkMatriculeFilter:function(){var e=new URL(document.location).searchParams.get("matricule");e&&(this.$store.commit("addFilter",{filterType:"matricule_id",value:e,tag:e}),this.showFilters=!0)}},mounted:function(){var e=this;this.checkMatriculeFilter(),this.applyFilter(),this.loadEntries(),f().get("/dossier_eleve/api/ask_sanctions/?page="+this.currentPage+this.filter+this.ordering).then((function(t){e.askSanctionsCount=t.data.count})),f().get("/dossier_eleve/api/ask_sanctions/?page="+this.currentPage+this.filter+this.ordering+"&activate_not_done=true").then((function(t){e.askSanctionsNotDoneCount=t.data.count}))},components:{filters:v.Z,"cas-eleve-entry":C,"export-modal":I,info:_.Z}};var N=n("./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/dossier_eleve/dossier_eleve.vue?vue&type=style&index=0&lang=css&");k()(N.Z,{insert:"head",singleton:!1}),N.Z.locals;var L=(0,j.Z)(A,c,[],!1,null,null,null);L.options.__file="assets/dossier_eleve/dossier_eleve.vue";const Z=L.exports;var T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",[n("b-row",[n("b-col",[n("h2",[e._v("\n                "+e._s(e.id<0?"Ajouter un cas":"Modifier un cas")+"\n            ")])])],1),e._v(" "),n("b-row",[n("b-col",[n("b-btn",{attrs:{to:"/"}},[e._v("\n                Retour à la liste\n            ")])],1)],1),e._v(" "),n("b-row",{staticClass:"mt-2"},[n("b-col",{attrs:{sm:"3"}},[n("div",{staticClass:"text-center"},[e.name.matricule?n("b-img",{attrs:{rounded:"",src:"/static/photos/"+e.name.matricule+".jpg",fluid:"",alt:"Photo de l'élève"}}):e._e()],1)]),e._v(" "),n("b-col",[n("b-form",{on:{submit:e.submit}},[n("b-form-row",[n("b-col",{attrs:{sm:"8"}},[n("b-form-group",{attrs:{label:"Nom","label-for":"input-name",state:e.inputStates.name}},[n("multiselect",{attrs:{id:"input-name","internal-search":!1,options:e.nameOptions,loading:e.nameLoading,placeholder:"Rechercher un étudiant…","select-label":"","selected-label":"Sélectionné","deselect-label":"",label:"display","track-by":"matricule"},on:{"search-change":e.getNameOptions},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[n("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Aucune personne trouvée.")]),e._v(" "),n("span",{attrs:{slot:"noOptions"},slot:"noOptions"})]),e._v(" "),n("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("name")))])],1)],1),e._v(" "),n("b-col",{attrs:{sm:"4"}},[n("b-form-group",{attrs:{label:"Matricule","label-for":"input-matricule"}},[n("b-form-input",{attrs:{id:"input-matricule",type:"text",readonly:""},model:{value:e.name.matricule,callback:function(t){e.$set(e.name,"matricule",t)},expression:"name.matricule"}})],1)],1)],1),e._v(" "),n("b-form-row",[n("b-col",[n("b-form-group",{attrs:{label:"Demandeur","label-for":"input-demandeur",state:e.inputStates.demandeur}},[n("multiselect",{attrs:{id:"input-demandeur","internal-search":!1,options:e.demandeurOptions,loading:e.demandeurLoading,placeholder:"Rechercher un responsable…","select-label":"","selected-label":"Sélectionné","deselect-label":"",label:"display","track-by":"display"},on:{"search-change":e.getDemandeurOptions},model:{value:e.demandeur,callback:function(t){e.demandeur=t},expression:"demandeur"}},[n("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v("Aucun responsable trouvée.")]),e._v(" "),n("span",{attrs:{slot:"noOptions"},slot:"noOptions"})]),e._v(" "),n("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("demandeur")))])],1)],1)],1),e._v(" "),n("b-form-row",{staticClass:"mb-2"},[n("b-col",[n("b-form-group",{attrs:{description:"Mettre en évidence les informations importantes sur le long terme (décès d'un parent, dyslexie, anorexie, idées noires...)."}},[n("b-form-checkbox",{model:{value:e.form.important,callback:function(t){e.$set(e.form,"important",t)},expression:"form.important"}},[e._v("\n                                Marquer comme important.\n                            ")])],1)],1)],1),e._v(" "),n("b-form-row",[n("b-col",[n("b-form-group",{attrs:{label:"Type d'info"}},[n("b-form-radio-group",{attrs:{id:"info-or-sanction",disabled:e.id>=0},model:{value:e.infoOrSanction,callback:function(t){e.infoOrSanction=t},expression:"infoOrSanction"}},[n("b-form-radio",{attrs:{value:"info"}},[e._v("\n                                    Non disciplinaire\n                                ")]),e._v(" "),n("b-form-radio",{attrs:{value:"sanction-decision",disabled:!e.$store.state.canSetSanction}},[e._v("\n                                    Disciplinaire\n                                ")])],1)],1)],1)],1),e._v(" "),"info"==e.infoOrSanction?n("div",[n("b-form-row",[n("b-col",[n("b-form-group",{attrs:{label:"Info","label-for":"input-info",state:e.inputStates.info_id}},[n("b-form-select",{attrs:{id:"input-info",options:e.infoOptions},model:{value:e.form.info_id,callback:function(t){e.$set(e.form,"info_id",t)},expression:"form.info_id"}},[n("template",{slot:"first"},[n("option",{attrs:{disabled:""},domProps:{value:null}},[e._v("\n                                            Choisissez un type d'info\n                                        ")])])],2),e._v(" "),n("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("info_id")))])],1)],1)],1)],1):e._e(),e._v(" "),"sanction-decision"==e.infoOrSanction?n("div",[n("b-form-row",[n("b-col",{attrs:{sm:"7"}},[n("b-form-group",{attrs:{label:"Info disciplinaire","label-for":"input-info",state:e.inputStates.sanction_decision_id}},[n("b-form-select",{attrs:{id:"input-info",options:e.sanctionDecisionOptions},model:{value:e.form.sanction_decision_id,callback:function(t){e.$set(e.form,"sanction_decision_id",t)},expression:"form.sanction_decision_id"}},[n("template",{slot:"first"},[n("option",{attrs:{disabled:""},domProps:{value:null}},[e._v("\n                                            Choisissez dans la liste\n                                        ")])])],2),e._v(" "),n("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("sanction_decision_id")))])],1),e._v(" "),n("b-form-group",{attrs:{label:"Date de la sanction","label-for":"input-date-sanction",state:e.inputStates.datetime_sanction}},[n("b-form-input",{attrs:{id:"input-date-sanction",type:"date"},model:{value:e.form.datetime_sanction,callback:function(t){e.$set(e.form,"datetime_sanction",t)},expression:"form.datetime_sanction"}}),e._v(" "),n("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("datetime_sanction")))])],1),e._v(" "),null!==e.form.sanction_faite?n("b-form-group",{attrs:{"label-for":"input-sanction-faite"}},[n("b-form-checkbox",{attrs:{id:"input-sanction-faite"},model:{value:e.form.sanction_faite,callback:function(t){e.$set(e.form,"sanction_faite",t)},expression:"form.sanction_faite"}},[e._v("\n                                    Sanction faite ?\n                                ")])],1):e._e()],1),e._v(" "),n("b-col",{attrs:{sm:"5"}},[n("b-list-group",e._l(e.stats,(function(t,s){return n("b-list-group-item",{key:s,staticClass:"d-flex justify-content-between align-items-center"},[n("strong",[e._v(e._s(t.display)+" :")]),e._v(" "+e._s(t.value)+"\n                                ")])})),1)],1)],1)],1):e._e(),e._v(" "),e.infoOrSanction?n("b-form-row",[n("b-col",[n("b-form-group",{attrs:{label:"Commentaires","label-for":"input-comment",state:e.inputStates.explication_commentaire}},[n("quill-editor",{attrs:{options:e.editorOptions},model:{value:e.form.explication_commentaire,callback:function(t){e.$set(e.form,"explication_commentaire",t)},expression:"form.explication_commentaire"}}),e._v(" "),n("span",{attrs:{slot:"invalid-feedback"},slot:"invalid-feedback"},[e._v(e._s(e.errorMsg("explication_commentaire")))])],1),e._v(" "),n("b-form-group",{attrs:{description:"Ajouter un ou des fichiers. Accepte uniquement des fichiers images et pdf.",label:"Fichier(s)"}},[n("b-form-file",{ref:"attachments",attrs:{multiple:"",accept:".pdf, .jpg, .png, jpeg",placeholder:"Attacher un ou des fichiers.","choose-label":"Attacher un ou des fichiers","drop-label":"Déposer des fichiers ici",plain:""},on:{input:e.addFiles},model:{value:e.attachments,callback:function(t){e.attachments=t},expression:"attachments"}}),e._v(" "),e._l(e.uploadedFiles,(function(t,s){return n("b-list-group",{key:s},[n("file-upload",{attrs:{id:t.id,file:t.file,path:"/dossier_eleve/upload_file/",removestr:5},on:{delete:function(t){return e.deleteFile(s)},setdata:function(t){return e.setFileData(s,t)}}})],1)}))],2)],1)],1):e._e(),e._v(" "),"info"==e.infoOrSanction?n("b-form-row",{staticClass:"mb-2"},[n("b-col",[e.visibilityOptions.length>0?n("b-form-group",{attrs:{label:"Donner la visibilité à :"}},[n("b-form-checkbox-group",{attrs:{stacked:"",name:"visible_by_groups",options:e.visibilityOptions,"value-field":"id","text-field":"text"},model:{value:e.form.visible_by_groups,callback:function(t){e.$set(e.form,"visible_by_groups",t)},expression:"form.visible_by_groups"}})],1):e._e(),e._v(" "),n("b-form-checkbox",{attrs:{disabled:!e.$store.state.canSetSanction},model:{value:e.form.send_to_teachers,callback:function(t){e.$set(e.form,"send_to_teachers",t)},expression:"form.send_to_teachers"}},[e._v("\n                            Envoyer l'info par courriel aux professeurs de la classe de l'élève (les fichiers seront joints).\n                        ")])],1)],1):e._e(),e._v(" "),e.form.info_id||e.form.sanction_decision_id?n("b-btn",{attrs:{variant:"primary",type:"submit",disabled:e.sending}},[e._v("\n                    Soumettre\n                ")]):e._e()],1)],1)],1)],1)};T._withStripped=!0;var R=n("./node_modules/vue-quill-editor/dist/vue-quill-editor.js"),q=(n("./node_modules/quill/dist/quill.core.css"),n("./node_modules/quill/dist/quill.snow.css"),n("./assets/common/file_upload.vue"));function Y(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}g().locale("fr"),window.axios=f(),window.axios.defaults.baseURL=window.location.origin;var U={xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"};const H={props:{id:{type:String,default:"-1"}},data:function(){return{casObject:null,form:{name:"",matricule_id:null,info_id:null,sanction_decision_id:null,explication_commentaire:"",important:!1,demandeur:"",visible_by_groups:[],datetime_sanction:null,sanction_faite:null,send_to_teachers:!1,attachments:[]},attachments:[],uploadedFiles:[],infoOrSanction:null,infoOptions:[],sanctionDecisionOptions:[],name:{matricule:null},nameOptions:[],nameLoading:!1,demandeur:{},demandeurOptions:[],demandeurLoading:!1,searchId:0,stats:{},timeSanction:null,errors:{},inputStates:{name:null,info_id:null,sanction_decision_id:null,demandeur:null,explication_commentaire:null},visibilityOptions:[],editorOptions:{modules:{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["clean"]]},placeholder:""},sending:!1}},watch:{name:function(){var e=this;this.name.matricule&&(this.form.name="".concat(this.name.fullname),this.form.matricule_id=this.name.matricule,f().get("dossier_eleve/api/statistics/"+this.name.matricule+"/").then((function(t){e.stats=JSON.parse(t.data)})).catch((function(e){alert(e)})),this.setVisibilityGroups())},infoOrSanction:function(e){"info"==e?this.form.sanction_decision_id=null:this.form.info_id=null},errors:function(e){var t=["name","info_id","sanction_decision_id","demandeur","explication_commentaire"];for(var n in t)this.inputStates[t[n]]=t[n]in e?0==e[t[n]].length:null}},methods:{addFiles:function(){for(var e in this.attachments)this.uploadedFiles.push({file:this.attachments[e],id:-1});this.attachments.splice(0,this.attachments.length)},setFileData:function(e,t){this.uploadedFiles[e].id=t.id,this.uploadedFiles[e].link=t.attachment},deleteFile:function(e){this.uploadedFiles.splice(e,1),this.$refs.attachments.reset()},errorMsg:function(e){return e in this.errors?this.errors[e][0]:""},setCas:function(){if(this.casObject){if(this.name={display:this.casObject.matricule.display,fullname:"".concat(this.casObject.matricule.last_name," ").concat(this.casObject.matricule.first_name),matricule:this.casObject.matricule_id,classe:this.casObject.matricule.classe.id},this.demandeur={display:this.casObject.demandeur},this.form.explication_commentaire=this.casObject.explication_commentaire,this.form.info_id=this.casObject.info_id,this.form.important=this.casObject.important,this.form.sanction_decision_id=this.casObject.sanction_decision_id,this.casObject.datetime_sanction){var e=g()(this.casObject.datetime_sanction);this.form.datetime_sanction=e.format("YYYY-MM-DD"),this.timeSanction=e.format("HH:MM")}if(this.form.sanction_faite=this.casObject.sanction_faite,this.infoOrSanction=this.casObject.info_id?"info":"sanction-decision",this.casObject.info_id&&(this.form.visible_by_groups=this.casObject.visible_by_groups,this.casObject.visible_by_tenure&&this.form.visible_by_groups.push(-1)),this.setSanctionDecisionOptions(),this.casObject.attachments.length>0)for(var t in this.casObject.attachments)this.uploadedFiles.push({id:this.casObject.attachments[t],file:null})}},submit:function(e){var t=this;e.preventDefault(),this.form.demandeur=this.demandeur.display;var n=this.form;if("sanction-decision"==this.infoOrSanction)n.visible_by_groups=Object.keys(groups).map((function(e){return groups[e].id}));else{var s=n.visible_by_groups.findIndex((function(e){return-1===e}));s>=0?(n.visible_by_groups.splice(s,1),n.visible_by_tenure=!0):n.visible_by_tenure=!1}if(n.datetime_sanction){var i=this.timeSanction?" "+this.timeSanction:" 12:00";n.datetime_sanction+=i}this.uploadedFiles.length>0?n.attachments=Array.from(this.uploadedFiles.map((function(e){return e.id}))):this.casObject&&(n.attachments=[]);var a=this,o="/dossier_eleve/api/cas_eleve/";this.casObject&&(o+=this.id+"/"),(this.casObject?f().put(o,n,U):f().post(o,n,U)).then((function(){t.sending=!1,t.$router.push("/",(function(){t.$root.$bvToast.toast("Les données ont bien été envoyées",{variant:"success",noCloseButton:!0})}))})).catch((function(e){a.errors=e.response.data}))},getNameOptions:function(e){return this.getPeopleOptions(e,"student")},getDemandeurOptions:function(e){return this.getPeopleOptions(e,"responsible")},getPeopleOptions:function(e,t){var n=this,s=this;this.searchId+=1;var i=this.searchId;"student"==t&&(this.nameLoading=!0),"responsible"==t&&(this.demandeurLoading=!0);var a={query:e,teachings:this.$store.state.settings.teachings,people:t,check_access:!0,tenure_class_only:this.$store.state.settings.filter_teacher_entries_by_tenure};f().post("/annuaire/api/people/",a,U).then((function(e){if(n.searchId===i){var s=e.data.map((function(e){var t={display:e.last_name+" "+e.first_name,matricule:e.matricule};if("is_secretary"in e){if(n.$store.state.settings.teachings.length>1){var s=" —";for(var i in e.teaching)s+=" "+e.teaching[i].display_name;t.display+=s}}else t.fullname=t.display,t.display+=" "+e.classe.year+e.classe.letter.toUpperCase(),t.classe=e.classe.id,n.$store.state.settings.teachings.length>1&&(t.display+=" – "+e.teaching.display_name);return t}));"student"==t?(n.nameLoading=!1,n.nameOptions=s):"responsible"==t&&(n.demandeurLoading=!1,n.demandeurOptions=s)}})).catch((function(e){alert(e),s.nameLoading=!1}))},setSanctionDecisionOptions:function(){var e=this;f().get("/dossier_eleve/api/sanction_decision/").then((function(t){e.sanctionDecisionOptions=t.data.results.map((function(t){var n={value:t.id,text:t.sanction_decision};return e.$store.state.settings.enable_submit_sanctions&&(n.disabled=t.can_ask),n})),e.$store.state.settings.enable_submit_sanctions&&(e.sanctionDecisionOptions=e.sanctionDecisionOptions.filter((function(t){return e.form.sanction_decision_id===t.value||!t.disabled})))})).catch((function(e){alert(e)}))},setVisibilityGroups:function(){var e=this,t=this.$store.state.settings,n=Object.assign({},groups);if(n.tenure={id:-1,text:"Titulaire(s)"},user_groups.find((function(e){return e.id==n.sysadmin.id})))this.visibilityOptions=Object.values(n).filter((function(e){return e.id!==n.sysadmin.id}));else{var s={direction:"dir",educateur:"educ",professeur:"teacher",pms:"pms",coordonateur:"coord"},i=Object.keys(s),a=user_groups.filter((function(e){return i.includes(e.name)})).map((function(e){var n=s[e.name]+"_allow_visibility_to",i=s[e.name]+"_force_visibility_to",a={group:e.id,isAllowed:new Set(t[n]),isForced:new Set(t[i])};return t.tenure_force_visibility_from.includes(e.id)&&a.isForced.add(-1),t.tenure_allow_visibility_from.includes(e.id)&&a.isAllowed.add(-1),a}));user_properties.tenure.includes(this.name.classe)&&a.push({group:-1,isAllowed:new Set(t.tenure_allow_visibility_to),isForced:new Set(t.tenure_force_visibility_to)});var o=Y(new Set(a.map((function(e){return e.isAllowed})).reduce((function(e,t){return new Set([].concat(Y(t),Y(e)))}),new Set)));this.visibilityOptions=o.map((function(t){var s=Object.values(n).find((function(e){return e.id===t}));return a.find((function(e){return Y(e.isAllowed).includes(t)&&!Y(e.isForced).includes(t)}))?(s.disabled=!1,s):a.find((function(e){return Y(e.isAllowed).includes(t)&&Y(e.isForced).includes(t)}))?(e.form.visible_by_groups.push(t),s.disabled=!0,s):s}))}}},components:{Multiselect:F(),quillEditor:R.quillEditor,FileUpload:q.Z},mounted:function(){var e=this;this.id>=0?f().get("/dossier_eleve/api/cas_eleve/".concat(this.id)).then((function(t){e.casObject=t.data,e.setCas()})):f().get("/annuaire/api/responsible/".concat(user_properties.matricule)).then((function(t){if(e.demandeur=t.data,e.$store.state.settings.teachings.length>1){var n=" —";for(var s in e.demandeur.teaching)n+=" "+e.demandeur.teaching[s].display_name;e.demandeur.display+=n}})),f().get("/dossier_eleve/api/info/").then((function(t){e.infoOptions=t.data.results.map((function(e){return{value:e.id,text:e.info}}))})).catch((function(e){alert(e)})),this.setSanctionDecisionOptions()}};var X=(0,j.Z)(H,T,[],!1,null,null,null);X.options.__file="assets/dossier_eleve/cas.vue";const V=X.exports;i().use(l.Z);const G=new l.Z({routes:[{path:"/",component:Z},{path:"/edit/:id/",component:V,props:!0},{path:"/new/",component:V,props:!0}]});var B=n("./assets/common/menu.vue");new(i())({el:"#vue-app",data:{transitionName:"slide-left",menuInfo:{}},store:r,router:G,template:'\n    <div>\n    <app-menu :menu-info="menuInfo"></app-menu>\n      <transition :name="transitionName" mode="out-in">\n        <router-view></router-view>\n      </transition>\n    </div>',mounted:function(){this.menuInfo=menu},components:{"app-menu":B.Z},watch:{$route:function(e,t){var n=e.path.split("/").length,s=t.path.split("/").length;this.transitionName=n<s?"slide-right":"slide-left"}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/dossier_eleve/casEleveEntry.vue?vue&type=style&index=0&lang=css&":(e,t,n)=>{n.d(t,{Z:()=>a});var s=n("./node_modules/css-loader/dist/runtime/api.js"),i=n.n(s)()((function(e){return e[1]}));i.push([e.id,"\n.current-card:hover {\n    background-color: rgba(255, 255, 255, 1) !important;\n}\n.category {\n    text-align: left;\n}\n.current-data {\n    text-align: left;\n    background-color: rgba(180, 180, 180, 0.25);\n}\n.entry-subtitle {\n    color: grey;\n}\n.fade-enter-active {\n  transition: opacity .7s\n}\n.fade-enter, .fade-leave-to .fade-leave-active {\n  opacity: 0\n}\n.info {\n    background-color: rgba(191, 221, 255, 0.1) !important;\n}\n.sanction_decision {\n    background-color: rgba(180, 255, 123, 0.05) !important;\n}\n.important {\n    background-color: rgba(255, 0, 0, 0.3) !important;\n}\n.clickable {\n    text-decoration: underline !important;\n    color: #0069d9 !important;\n}\n.clickable:hover {\n    cursor: pointer;\n    color: rgb(0, 0, 150) !important;\n}\n.move-up {\n    margin-top: -25px;\n}\n.new {\n    box-shadow: 0px 0px 5px #0069d9;\n    border-color: #0069d9;\n}\n",""]);const a=i},"./node_modules/css-loader/dist/cjs.js!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/vue-loader/lib/index.js??vue-loader-options!./assets/dossier_eleve/dossier_eleve.vue?vue&type=style&index=0&lang=css&":(e,t,n)=>{n.d(t,{Z:()=>d});var s=n("./node_modules/css-loader/dist/runtime/api.js"),i=n.n(s),a=n("./node_modules/css-loader/dist/runtime/getUrl.js"),o=n.n(a),r=n("./static/img/spin.svg"),l=i()((function(e){return e[1]})),c=o()(r.Z);l.push([e.id,'\n.loading {\n  content: " ";\n  display: block;\n  position: absolute;\n  width: 80px;\n  height: 80px;\n  background-image: url('+c+");\n  background-size: cover;\n  left: 50%;\n  top: 50%;\n}\n",""]);const d=l}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}s.m=t,e=[],s.O=(t,n,i,a)=>{if(!n){var o=1/0;for(c=0;c<e.length;c++){for(var[n,i,a]=e[c],r=!0,l=0;l<n.length;l++)(!1&a||o>=a)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(r=!1,a<o&&(o=a));r&&(e.splice(c--,1),t=i())}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,i,a]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),s.j=197,(()=>{var e={197:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[o,r,l]=n,c=0;for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(l)var d=l(s);for(t&&t(n);c<o.length;c++)a=o[c],s.o(e,a)&&e[a]&&e[a][0](),e[o[c]]=0;return s.O(d)},n=self.webpackChunkhappyschool=self.webpackChunkhappyschool||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=s.O(void 0,[351],(()=>s("./assets/js/dossier_eleve.js")));i=s.O(i)})();